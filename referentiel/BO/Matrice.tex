% # context : data, utils, year, parcours
%% set comps=data.getPossibleCompObjects(data.getParcoursObjects(year=year,interparcours=parcours),year)
%% for comp in comps
%% set apcs=comp.getAPCObjects(year=year)
%% set allcolumns=apcs.__len__()+2
\newpage
\fancyfoot[R]{2021\\\VAR{data.getId()|le} (parcours \VAR{parcours.getLettreList()|elegantjoin|le})}
\begin{center}
  {
    \fontsize{24}{36}\fontspec{Arial}\bfseries
    Matrice A\VAR{year|le} — C\VAR{comp.getNum()|le} — Parcours \VAR{parcours.getLettreList()|elegantjoin|le}
  }\\
  \large
  C\VAR{comp.getNum()|le}~\VAR{comp.getShorttxt()|le}\qquad \VAR{parcours.getNameList()|elegantjoin|le}
\end{center}
\begin{center}
  \begin{tabular}{|l|>{\bfseries}c|\BLOCK{for apc in comp.getAPCObjects(year=year)}p{25mm}|\BLOCK{endfor}}\hline
    Ressource/SAÉ
    &
      \rotatebox[origin=r]{90}{Coeff.}
    &      
    %% for apc in apcs
      \centering\arraybackslash \textbf{APC \VAR{apc.getNum()|le}}\par\raggedright\arraybackslash\fontsize{7pt}{9pt}\selectfont \VAR{apc.getShorttxt()|le}
      %% if not loop.last
    &
    %% endif
    %% endfor
    \\\hline
    %% for sem in data.getSemestres(year=year) 
    %% set lr=data.getRessourceObjects(semestre=sem,interparcours=parcours)
    %% set ls=data.getSAEObjects(semestre=sem,interparcours=parcours)
    %% for ll,lcode,lname in [(lr,'RESS','Ressources'),(ls,'SAE','SAÉ')]
    %% if ll|length>0
    % #    \multicolumn{\VAR{allcolumns}}{|c|}{\textbf{\VAR{lname}}}\\\hline
    %% set co=comp.getCoeffs(onlyType=[lcode],semestre=sem)
    \textbf{\VAR{lname}} &
    %% if co
                           \VAR{co[1]|le}
                           %% endif
    &
                           %% for apc in apcs
                           %% if not loop.last
    \multicolumn{1}{c}{}&
    %% endif
    %% endfor
    \\\hline
    %% for m in ll
    \VAR{m.getId()|le}~\VAR{m.getShorttxt()|le}
    &
    %% set co=comp.getCoeff(m)
    %% if co
      \VAR{co[1]|le}
      %% endif
    &
    %% for apc in apcs:
    %% if apc.getId() in m.getAPCList()
      \multicolumn{1}{c|}{X}
      %% endif
      %% if not loop.last:
    &
    %% endif
    %% endfor
    \\\hline
    %% endfor
    %% endif
    %% endfor
    %% endfor
  \end{tabular}
\end{center}
%% endfor