% # context : data, sem, parcours
%% set year=sem|semestre2year
\subsubsection{Participation aux SAÉ du S\VAR{sem|le} — \VAR{parcours.getCanonical(lower=False)|le}}
\selectparcours{\VAR{parcours.getCanonical()|le}}
\begin{minipage}{\textwidth}
  \begin{center}
    %% set lr=data.getModule(onlyType=['RESS'],semestre=sem,interparcours=parcours)
    %% set ls=data.getModule(onlyType=['SAE','PORTFOLIO'],semestre=sem,interparcours=parcours)
    %% set cols=ls|length
    %% set comptabform='>{\columncolor{red}}r@{\hspace{2pt}}>{\itshape}r'*cols
    \bigskip
    \resetwidth
    %% for m in ls
    \maxwidth{\textbf{\VAR{m.id|le}}}
    \maxwidth{\VAR{m.getShortname()|le}}
    %% endfor
    \begin{tabular}{l%
        %% for col in ls
        cc%
        %% endfor
      }
      \toprule
      \parbox[b]{5cm}{
        \begin{flushleft}
          Ressources\\
          Heures de TD+Heures de TP\\
          X = participation sans formation fléchée.
        \end{flushleft}
      }
      %% for m in ls
      &
      \multicolumn{2}{c}{\hyperref[FICHE-\VAR{m.id|le}]{\rothead{%
            \textbf{\VAR{m.id|le}}\\
            \VAR{m.getShortname()|le}
          }}}
      %% endfor
      \\
      %% for m in ls
      \cmidrule(lr){\VAR{loop.index*2}-\VAR{loop.index*2+1}}
      %% endfor
      
      %% for m in ls
      &
      \multicolumn{1}{c}{\rotatebox{0}{TD}}
      &
      \multicolumn{1}{c}{\rotatebox{0}{TP}}
      %% endfor
      \\
      \midrule
      %% set colors=[0,0,4,0,0,4,4,4,8]
      %% for m in lr
      %% set colors=[0,0,4,0,0,4,0,0,4]
      %% set colorindex=(loop.index % 3)
      %% if colors[colorindex]>0
      \rowcolor{black!\VAR{colors[colorindex]}!whitepagecolor}
      %% endif
      %% set colors=[0,0,0,0,0,0,0,0,0]
      \hyperref[FICHE-\VAR{m.id|le}]{\VAR{m.getShortCanonical()|le}}
      %% set hoursout=data.getHours(source=m)
      %% set outerloop=loop
      %% for mm in ls
      %% set innerloop=loop
      %% set colorindex=(outerloop.index % 3)+3*(innerloop.index % 3)
      &
      %% set types=['TD','TP']
      %% if mm not in hoursout.destinations()
      %% if types.pop()
      %% endif
      \multicolumn{2}{c}{
        %% endif
        %% for xt in types
        %% if loop.index == 2
        &
        %% endif
        %% if colors[colorindex]>0
        \cellcolor{black!\VAR{colors[colorindex]}}
        %% endif
        %% if mm in hoursout.destinations(onlyType=[xt])
        \VAR{hoursout.sum(onlyType=[xt],destination=mm)|hoursnum}
        %% else
        %% if m in mm.ress.values() and loop.length == 1
        X
        %% endif
        %% endif
        %% if loop.last and loop.index==1
      }
      %% endif
      %% endfor
      %% endfor
      \\
      %% endfor
      \bottomrule
    \end{tabular}
  \end{center}
\end{minipage}

