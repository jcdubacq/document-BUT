% # context : data, utils, sem, parcours
%% set year=utils.semestre2year(sem)
\subsubsection{Coefficients S\VAR{sem|le} — \VAR{parcours.getCanonical(lower=False)|le}}
\selectparcours{\VAR{parcours.getCanonical()|le}}
%% set lr=data.getModule(onlyType=['RESS'],semestre=sem,interparcours=parcours)
%% set ls=data.getModule(onlyType=['SAE'],semestre=sem,interparcours=parcours)
%% set lp=data.getModule(onlyType=['PORTFOLIO'],semestre=sem,interparcours=parcours)
%% set comps=parcours.getCompLevel(year)|sort(attribute='id')
%% set compn=comps|length
%% set comptabform='r'*compn
%% set allcolumns=compn+1
%% set total=[]
\begin{center}
  \begin{tabular}{l\VAR{comptabform}}
    \toprule
    Ressource/SAÉ
    & 
    %% for c in comps
    %% set ue=c.getUE(semestre=sem)
    \rotatebox{90}{UE\VAR{sem|le}.\VAR{c.parent.number|le}}
    %% if not loop.last
    &
    %% endif
    %% endfor
    \\\midrule
    %% for ll,lcode,Lname in [(ls,'SAE','SAÉ'),(lp,'PORTFOLIO','Portfolio'),(lr,'RESS','Ressources')]
    \addlinespace{}%
    \textbf{\VAR{Lname}}
    %% set ctot=[]
    %% for c in comps
    %% set ue=c.getUE(semestre=sem)
    %% set coeffs=ue.getCoeff(module=ll)
    %% if ctot.append(coeffs.sum())
    %% endif
    %% endfor
    %% if total.append(ctot)
    %% endif
    %% if ctot|sum>0
    %% for x in ctot
    &
    \textbf{\VAR{x|le}}
    %% endfor
    %% else
    & \multicolumn{\VAR{allcolumns-1}}{c}{\rule{0ex}{2ex}\emph{Non évalué ce semestre}}
    %% endif
    \\
    %% for m in ll
    \hyperref[FICHE-\VAR{m.id|le}]{\VAR{m.getCanonical()|le}}
    &
    %% set sumco=[]
    %% for co in m.getCoeff()
    %% set v=co.value|int
    %% if sumco.append(v)
    %% endif
    %% endfor
    %% if sumco|sum > 0
    %% for c in comps
    %% set co=m.getCoeff(c.parent)
    %% for coeff in co
    \VAR{coeff.value|le}
    %% endfor
    %% if not loop.last:
    &
    %% endif
    %% endfor
    %% else
    \multicolumn{\VAR{allcolumns-1}}{c}{\rule{0ex}{2ex}—}
    %% endif
    \\
    %% endfor
    %% endfor
    \addlinespace\textbf{Total}
    %% for x in total[0]
    &
    \textbf{\VAR{(x+total[1][loop.index0]+total[2][loop.index0])|le}}
    %% endfor
    \\
    \bottomrule
  \end{tabular}
  \bigskip
  
  \begin{tabular}{l@{\hspace{2pt}}p{11cm}lrrrr}
    \toprule
    \multicolumn{2}{l}{\textbf{Compétence}}&\textbf{UE}&\textbf{SAÉ}&\textbf{Po.}&\textbf{Re.}&\textbf{ECTS}\\
    \midrule
    %% for c in comps
    %% set ue=c.getUE(semestre=sem)
    \hyperref[FICHE-\VAR{c.id|le}]{\textbf{C\VAR{c.parent.number|le}}}&
    \hyperref[FICHE-\VAR{c.id|le}]{\VAR{c.parent.getName()|le}} &
    UE\VAR{sem|le}.\VAR{c.parent.number|le}
    %% set outerloop=loop
    %% for t in total
    & \VAR{t[outerloop.index0]|le}
    %% endfor
    & \VAR{ue.ects|le}\\
    &
    \multicolumn{6}{@{\hspace{2pt}}l}{\small\emph{\hyperref[FICHE-\VAR{c.id|le}]{\VAR{c.getName()|le}}}}\\
    %% endfor
    \bottomrule
  \end{tabular}
  
\end{center}


